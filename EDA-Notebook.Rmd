---
title: "Code Notebook"
author: "Eileena Mathews, Hayden Pozzi, Rachel Perry, and Richard Liu"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
# setup: load libraries and options
library(tidyverse)
library(readr)
library(haven)
library(janitor)
library(scales)
library(stringr)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
set.seed(2025)
```

## Introduction

In recent years, artificial intelligence (AI) has undergone a profound shift in public perception. Once seen primarily as a source of uncertainty or even risk, AI is now becoming something people feel increasingly comfortable withâ€”if not socially or professionally expected to use. From writing assistants and chatbots to algorithmic recommendations in education, finance, and entertainment, AI has become an embedded feature of everyday life.

To ground our analysis, we use the Public Attitudes to AI dataset produced by the Ada Lovelace Institute (UK). This nationally representative survey of ~4,000 adults provides perceptions across multiple AI application domains. Our aim here is a reproducible initial exploration: inspect structure and missingness, perform light cleaning, compute simple summaries, and visualise perceived benefits of AI in hiring.

## Load data

```{r load-data}
ai_path <- "how-do-people-feel-about-ai-main/262400371_Public Attitudes to AI Raw Data NA (1).csv"
if (!file.exists(ai_path)) stop("Data file not found: ", ai_path)
ai_survey1 <- read_csv(ai_path, show_col_types = FALSE)
glimpse(ai_survey1)
```

## Cleaning the data 
The original team developed their own data-cleaning code. We adopted their version since it was already effectively cleaned, and we wanted to avoid unnessecary complications.  


```{r}
## functions to simplify data tidying

## recoding technology labels
recode_technologies <- function(Technology_specific) {
  recode(Technology_specific,
                  "WEL" = "Welfare eligibility",
                "JOB" =  "Job eligibility",
                "CAN" =  "Cancer risk",
                "LOAN" = "Loan repayment risk", 
                "MP" =  "Mobile phone unlock",
                 "BC" = "Border control",
                 "PS" = "Police surveillance",

                "AW"  = "Autonomous weapons", 
                "DC" =  "Driverless cars",
                "RCA" = "Robotic care assistant",
               "RVC" ="Robotic vacuum cleaner",
                                                                         
               "SMC"=  "Targeted consumer ads",
                "SMP" = "Targeted political ads",
                                                                         
                "VASS"=  "Smart speaker",
                "VAH"=  "Virtual healthcare assistant",
                                 
              "CCR"=   "Climate change simulation",
                "VR"=  "Education simulations")
  
}

## list of demographic variables of interest
demog <- df1 %>%
  remove_val_labels() %>%
  dplyr::select(
  Respondent_ID, PV25_Weight,
  RS_Ethnicity_Combined,
  CS_Age_Band,
  RS_Sex,
  RS_EducationLevel,
  DR_Socio_Eco
  ) %>%
  mutate(RS_Ethnicity_Combined = 
           dplyr::recode(RS_Ethnicity_Combined,
             "1" = "White",
             "2" = "Asian or Asian British",
             "3" = "Black British, Caribbean or African",
             "4" = "Any other ethnic group"
           )) %>%
  mutate(CS_Age_Band = 
           dplyr::recode(CS_Age_Band,
             "1" = "18-24 yrs",
             "2" = "25-34 yrs",
             "3" = "35-44 yrs",
             "4" = "45-54 yrs",
             "5" = "55-64 yrs",
             "6" = "65-74 yrs",
             "7" = "75+ yrs"
           )) %>%
  mutate(RS_Sex = 
           dplyr::recode(RS_Sex,
             "1" = "Male",
             "2" = "Female")) %>%
  mutate(RS_EducationLevel = 
           dplyr::recode(RS_EducationLevel,
             "1" = "Degree level qualification(s)",
             "2" = "Non-degree level qualifications",
             "3" = "No academic or vocational qualifications")) %>%
  mutate(DR_Socio_Eco = 
           dplyr::recode(DR_Socio_Eco,
             "1" = "SEC1, 2",
             "2" = "SEC3",
             "3" = "SEC4",
             "4" = "SEC5",
             "5" = "SEC6, 7",
             "6" = "SEC8",
             "7" = "Students")) %>%
  pivot_longer(names_to = "Q_Demo",
               values_to = "A_Demo",
               RS_Ethnicity_Combined:DR_Socio_Eco)

# list of levels 
demo_list <- c("White",
  "Asian or Asian British",
  "Black British, Caribbean or African", 
  "Any other ethnic group", 
  
  "18-24 yrs",
  "25-34 yrs",
  "35-44 yrs",
  "45-54 yrs",
  "55-64 yrs",
  "65-74 yrs",
  "75+ yrs", 
  
  "Male",
  "Female",
  "Identify in another way",
  
  "Degree level qualification(s)",
  "Non-degree level qualifications",
  "No academic or vocational qualifications",
  
  "SEC1, 2",
  "SEC3",
  "SEC4",
  "SEC5",
  "SEC6, 7",
  "SEC8",
  "Students", 
  
  "Total" )
```

## Inspect variables and missingness

```{r inspect-variables}
var_df <- tibble(
  var = names(ai_survey1),
  class = map_chr(ai_survey1, ~ class(.x)[1]),
  missing = map_int(ai_survey1, ~ sum(is.na(.x))),
  unique_vals = map_int(ai_survey1, ~ n_distinct(.x, na.rm = TRUE))
) %>% arrange(desc(missing))

print(var_df, n = 250)
```

## Basic cleaning and derived columns

```{r clean-data}
# Standardise names and add row id
ai_clean <- ai_survey1 %>%
  clean_names() %>%
  mutate(row_id = row_number())

# Detect age column (common names cs_age, csage, cs_age_yrs, age)
age_col <- names(ai_clean)[str_detect(names(ai_clean), regex("\\b(cs_age|csage|age|age_years|cs_age_yrs)\\b", ignore_case = TRUE))] %>% .[1]
if (!is.na(age_col)) {
  ai_clean <- ai_clean %>%
    mutate(age = as.integer(.data[[age_col]])) %>%
    filter(is.na(age) | age >= 17)  # remove implausible 16 if present
}

# Detect sex/gender column
sex_col <- names(ai_clean)[str_detect(names(ai_clean), regex("^rs_sex$|sex|gender", ignore_case = TRUE))] %>% .[1]
if (!is.na(sex_col)) {
  ai_clean <- ai_clean %>%
    mutate(
      sex_raw = as.character(.data[[sex_col]]),
      sex = case_when(
        sex_raw %in% c("1", 1, "Male", "male", "M") ~ "Male",
        sex_raw %in% c("2", 2, "Female", "female", "F") ~ "Female",
        TRUE ~ NA_character_
      )
    )
}

# Detect BENB-like columns and coerce to 0/1 integers where possible
benb_cols <- names(ai_clean)[str_detect(names(ai_clean), regex("^benb|benb_job|benefit|benefits|benb_", ignore_case = TRUE))]
if (length(benb_cols) == 0) {
  benb_cols <- names(ai_clean)[str_detect(names(ai_clean), regex("benefit|benb|job", ignore_case = TRUE))]
}

if (length(benb_cols) > 0) {
  ai_clean <- ai_clean %>%
    mutate(across(all_of(benb_cols), ~ {
      x <- .
      # character encodings -> 1/0
      if (is.character(x)) {
        xl <- str_to_lower(str_trim(x))
        as.integer(if_else(xl %in% c("yes","y","1","selected","true","t"), 1L,
                   if_else(xl %in% c("no","n","0","false","f"), 0L, NA_integer_)))
      } else if (is.logical(x)) {
        as.integer(x)
      } else {
        # numeric-like: keep 1/0, else NA
        xi <- suppressWarnings(as.integer(x))
        if_else(is.na(xi), NA_integer_, xi)
      }
    }))
}
# quick check
glimpse(select(ai_clean, any_of(c("age","sex", benb_cols))))
```

## Derive overall benefit tallies (unweighted)

```{r derive-overall-ben}
# Use cleaned benb columns and treat 1 as selected
if (length(benb_cols) > 0) {
  overall_ben <- ai_clean %>%
    select(all_of(benb_cols)) %>%
    mutate(row_id = row_number()) %>%
    pivot_longer(cols = -row_id, names_to = "benefit_raw", values_to = "selected") %>%
    filter(!is.na(selected) & selected == 1L) %>%
    mutate(benefit = benefit_raw) %>%
    count(benefit) %>%
    mutate(pct = n / sum(n))
} else {
  overall_ben <- tibble(benefit = character(0), n = integer(0), pct = numeric(0))
  message("No BENB-like columns detected. Check variable names and adjust the detection pattern.")
}

overall_ben %>% arrange(desc(pct)) %>% print(n = 50)
```

## Summary statistics

```{r summary-stats}
# Age summaries
if ("age" %in% names(ai_clean)) {
  age_stats <- ai_clean %>%
    summarise(
      n = sum(!is.na(age)),
      mean_age = mean(age, na.rm = TRUE),
      median_age = median(age, na.rm = TRUE),
      sd_age = sd(age, na.rm = TRUE),
      min_age = min(age, na.rm = TRUE),
      max_age = max(age, na.rm = TRUE)
    )
  print(age_stats)
}

# Sex / gender distribution
if ("sex" %in% names(ai_clean)) {
  print(ai_clean %>% count(sex, sort = TRUE) %>% mutate(p = n / sum(n)))
}

# Top benefits preview
if (exists("overall_ben") && nrow(overall_ben) > 0) {
  print(overall_ben %>% arrange(desc(pct)) %>% slice_head(n = 10))
}
```

## Visualisations

```{r plots, fig.width=7, fig.height=4}
# Age histogram
if ("age" %in% names(ai_clean)) {
  ggplot(filter(ai_clean, !is.na(age)), aes(age)) +
    geom_histogram(binwidth = 5, fill = "steelblue", color = "white") +
    labs(title = "Age distribution", x = "Age", y = "Count")
}

# Sex / gender bar
if ("sex" %in% names(ai_clean)) {
  ggplot(filter(ai_clean, !is.na(sex)), aes(x = fct_infreq(sex))) +
    geom_bar(fill = "darkorange") +
    coord_flip() +
    labs(title = "Sex / Gender distribution", x = NULL, y = "Count")
}

# Benefits bar (top 8)
if (exists("overall_ben") && nrow(overall_ben) > 0) {
  top8 <- overall_ben %>% slice_max(pct, n = 8) %>% pull(benefit)
  overall_ben %>%
    filter(benefit %in% top8) %>%
    ggplot(aes(reorder(benefit, pct), pct)) +
    geom_col(fill = "steelblue") +
    coord_flip() +
    scale_y_continuous(labels = percent) +
    labs(x = NULL, y = "Unweighted % selecting",
         title = "Perceived benefits of AI in hiring (top items)")
}
```

## Notes and next steps

- Confirm BENB column names and encoding (1/0 vs "Yes"/"No") and update detection patterns if necessary.
- If a survey weight column exists (common names: weight, wt, wgt), compute weighted percentages before reporting final estimates.
- Follow-up: demographic cross-tabs, subgroup comparison plots, and simple regression models.

## Session info

```{r session-info}
sessionInfo()
```
